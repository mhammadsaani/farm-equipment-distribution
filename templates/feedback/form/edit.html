{% extends 'layouts/admin.html' %}
{% load static %}
{% block title %} Feedback {% endblock %}
{% block content %}
<h4>Edit form</h4>
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
	<li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
	<li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
	<li class="breadcrumb-item"><a href="{% url 'feedback:form.index' %}">Feedback</a></li>
	<li class="breadcrumb-item active" aria-current="page">Edit form</li>
  </ol>
</nav>
<form action="#" method="post" enctype='multipart/form-data'>
	<div class="mb-2">
		<label for="name" class="form-label">Name</label>
		<input type="text" class="form-control" name="name" value='{{ form.name }}' required/>
	</div>
	<div class="mb-2">
		<label for="content" class="form-label">Description</label>
		<textarea 
            id='editor'
            class='form-control'
            name='description'
            placeholder="form description..."
        >{{ form.description|safe }}</textarea>
	</div>
	<div class='row bg-light p-4 my-3 rounded'>
		<div class='col-md-10' id='form-fields'>
            {% for field in question_fields %}
			<div class='row mb-2'>
				<div class='col-md-5'>
					<input type='text' value='{{ field.label }}' name='label' class='form-control' required/>
				</div>
				<div class='col-md-2'>
					<select class='form-control' name='field_type' required>
						<option value='{{ field.field_type }}'>{{ field.field_type }}</option>
						<option value='number'>number</option>
						<option value='text'>text</option>
						<option value='long-text'>long-text</option>
						<option value='boolean'>boolean</option>
						<option value='date'>date</option>
						<option value='select'>select</option>
					</select>
				</div>
				<div class='col-md-2'>
					<select class='form-control' name='width' required>
                        <option value=''> - width - </option>
                        <option value='6' {% if field.width == 6 %} selected {% endif %}>1/2</option>
						<option value='4' {% if field.width == 4 %} selected {% endif %}>1/3</option>
						<option value='3' {% if field.width == 3 %} selected {% endif %}>1/4</option>
						<option value='12' {% if field.width == 12 %} selected {% endif %}>full width</option>
					</select>
				</div>
				<div class='col-md-3'>
					<select class='form-control' name='is_required'>
						<option value=''> - field is required - </option>
						<option value='yes' {% if field.is_required %} selected {% endif %}>yes</option>
						<option value='' {% if field.is_required == False %} selected {% endif %}>no</option>
					</select>
				</div>
				<div class='mt-2 col-md-12'>
					<textarea
                        class='form-control'
                        name='choice'
                        placeholder='choice 1,choice 2'
                    >{{ field.choice }}</textarea>
				</div>
			</div>
            {% endfor %}
		</div>
		<div class='col-md-2 d-flex justify-content-between flex-column border-start border-2'>
			<button class='btn btn-info w-100 mb-2' id="add-field">
				<i class='bi bi-plus-circle me-1'></i> Add
			</button>
			<button class='btn btn-warning w-100 mb-2' id="remove-field">
				<i class='bi bi-dash-circle me-1'></i> Remove
			</button>
		</div>
	</div>
  {% csrf_token %}
  <div class='d-flex justify-content-between'>
		<button class="btn btn-primary" type="submit">Continue</button>
		<a class="btn btn-link" href="{% url 'feedback:form.index' %}">All forms</a>
  </div>
</form>
<div id='new-field' class='d-none'>
	<div class='row mb-2'>
		<div class='col-md-5'>
			<input type='text' placeholder='field label' name='label' class='form-control' required/>
		</div>
		<div class='col-md-2'>
			<select class='form-control' name='field_type' required>
				<option value=''> - field type - </option>
				<option value='number'>number</option>
				<option value='text'>text</option>
				<option value='long-text'>long-text</option>
				<option value='boolean'>boolean</option>
				<option value='date'>date</option>
				<option value='select'>select</option>
			</select>
		</div>
		<div class='col-md-2'>
			<select class='form-control' name='width' required>
				<option value=''> - width - </option>
				<option value='6'>1/2</option>
				<option value='4'>1/3</option>
				<option value='3'>1/4</option>
				<option value='12'>full width</option>
			</select>
		</div>
		<div class='col-md-3'>
			<select class='form-control' name='is_required'>
				<option value=''> - field is required - </option>
				<option value='yes'>yes</option>
				<option value=''>no</option>
			</select>
		</div>
		<div class='mt-2 col-md-12'>
			<textarea class='form-control' name='choice' placeholder='choice 1,choice 2'></textarea>
		</div>
	</div>
</div>
{% endblock %}
{% block scripts %}
<script src="{% static 'js/ckeditor.js' %}"></script>
<script>
  document.getElementById('add-field').addEventListener('click', function(e) {
		e.preventDefault()
		const newField = document.getElementById('new-field').innerHTML
		document.getElementById('form-fields').innerHTML += newField
  })
  document.getElementById('remove-field').addEventListener('click', function(e) {
		e.preventDefault()
		const fields = document.getElementById('form-fields')
		if (document.querySelectorAll('input[name=label]').length > 2)
			fields.removeChild(fields.lastElementChild)
  })
  ClassicEditor.create(document.querySelector('#editor'))
</script>
{% endblock %}