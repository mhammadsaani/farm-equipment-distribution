{% extends 'timeline/layout.html' %}
{% load static %}
{% block qna_content %}
{% if user.is_authenticated %}
<div class="card shadow-sm mb-3">
  <div class="card-header">Post new updates</div>
  <div class="card-body">
    <form action='{% url "timeline:post.create" %}' method='post' enctype='multipart/form-data'>
      <div class="row">
        <div class="col-md-8">
          {% csrf_token %}
          <textarea name="content" id="editor" class="form-control my-1" placeholder="Post new updates..."></textarea>
        </div>
        <div class="col-md-4">
          <div class="d-grid gap-2">
            <input type="file" class="form-control" name="attachment" accept='image/*' />
            <input type="text" class="form-control" name="tags" placeholder='tag 1, tag 2, tag 3' />
            <button class="btn btn-primary" type='submit'>Submit</button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
{% endif %}
<div class=''>
  <h4 class='mb-3'>Recent updates</h4>
  {% for post in page_object %}
  <div class="row bg-light mb-2 py-2">
    <div class="col">{{ post.content|safe }}</div>
    {% if post.attachment %}
    <div class="col-md-4"><img src="/media/{{ post.attachment }}" class="w-100"></div>
    {% endif %}
    {% if user.id == post.user_id %}
    <div class="col-md-1"><a href="{% url 'timeline:post.delete' id=post.id %}" class="btn btn-sm btn-warning"><i class="bi bi-x-lg"></i></a></div>
    {% endif %}
  </div>
  {% endfor %}
</div>
<nav aria-label="pagination">
  <ul class="pagination justify-content-center">
    {% if page_object.has_previous %}
    <li class="page-item"><a class="page-link" href='?page={{ page_object.previous_page_number }}'><i class='bi bi-chevron-left'></i></a></li>
    {% endif %}
    <li class="page-item"><a class="page-link" href="#">{{ page_object.number }} / {{ page_object.paginator.num_pages }}</a></li>
    {% if page_object.has_next %}
    <li class="page-item"><a class="page-link" href='?page={{ page_object.next_page_number }}'><i class='bi bi-chevron-right'></i></a></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}
{% block styles %}
<link href="{% static 'css/tagify.css' %}" rel="stylesheet" type="text/css" />
{% endblock %}
{% block scripts %}
<script src="{% static 'js/tagify.js' %}"></script>
<script src="{% static 'js/ckeditor.js' %}"></script>
<script src="{% static 'js/tagify.polyfills.min.js' %}"></script>
<script>
  ClassicEditor.create(document.querySelector('#editor'))
  let input = document.querySelector('input[name=tags]');
  new Tagify(input)
</script>
{% endblock %}
